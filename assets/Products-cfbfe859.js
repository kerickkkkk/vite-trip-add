import{a as l}from"./axios-a900fd7e.js";import{u as S}from"./users-35aa6e36.js";import{i as E,f as b,g as F,r as C,o as d,c as u,e as h,a as e,F as x,h as N,t as m,b as P,w as T}from"./index-b3e54e60.js";const U={class:"container"},z={class:"row"},A={class:"card"},V=["src"],D={class:"card-body"},I={class:"d-flex"},L={class:"card-title"},O=["onClick"],j={class:"card-text"},K={__name:"Products",setup(G){S();const o="https://ttshop-server.onrender.com",i=E("$swal"),{user:_,token:r}=JSON.parse(localStorage.getItem("ttshop")),p=b([]),v=b([]),g=()=>{l.get(`${o}/products`).then(({data:t})=>{p.value=t}).catch(t=>{var s;console.dir(t),i((s=t==null?void 0:t.response)==null?void 0:s.data)})},y=t=>{l({method:"GET",url:`${o}/600/users/${_.id}/likes?productId=${t}`,headers:{Authorization:`Bearer ${r}`}}).then(({data:s})=>{const n=s.length>0?s[0].id:null;w(n,_.id,t)}).catch(s=>{var n;console.dir(s),i((n=s==null?void 0:s.response)==null?void 0:n.data)})},w=(t,s,n)=>{const a=t===null?"POST":"DELETE",$=t===null?`${o}/600/likes/`:`${o}/600/likes/${t}`;l({method:a,url:$,data:t===null?{userId:s,productId:n}:{},headers:{Authorization:`Bearer ${r}`}}).then(c=>{k()}).catch(c=>{var f;console.dir(c),i((f=c==null?void 0:c.response)==null?void 0:f.data)})},k=()=>{l({method:"get",url:`${o}/600/users/${_.id}/likes?_expanded=post`,headers:{Authorization:`Bearer ${r}`}}).then(({data:t})=>{v.value=t.map(s=>({...s,userId:s.userId*1})),g()}).catch(t=>{var s;console.dir(t),i((s=t==null?void 0:t.response)==null?void 0:s.data)})},B=t=>v.value.find(s=>s.productId===t)===void 0;return F(()=>{k(),g()}),(t,s)=>{const n=C("router-link");return d(),u("div",null,[h(" 景點頁面 "),e("div",U,[e("div",z,[p.value.length>0?(d(!0),u(x,{key:0},N(p.value,a=>(d(),u("div",{key:a.id,class:"col-4"},[e("div",A,[e("img",{src:a.imageUrl,class:"card-img-top"},null,8,V),e("div",D,[e("div",I,[e("h5",L,m(a.title),1),e("button",{onClick:$=>y(a.id),class:"btn btn-outline-primary"},[e("span",null,m(B(a.id)?"取消":"加入"),1),h("最愛 ")],8,O)]),e("p",j,m(a.content),1),P(n,{to:`/product/${a.id}`,class:"btn btn-primary"},{default:T(()=>[h("看詳細")]),_:2},1032,["to"])])])]))),128)):(d(),u(x,{key:1},[h(" 沒有景點 ")],64))])])])}}};export{K as default};
