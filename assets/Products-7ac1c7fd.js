import{a as h}from"./axios-a900fd7e.js";import{h as S,i as C,r as b,o as E,a as F,b as l,c as d,g as _,d as a,F as x,j as N,t as m,k as P,f as T,e as U,w as V}from"./index-93194d17.js";const z={class:"container"},A={class:"row"},j={class:"card"},D=["src"],I={class:"card-body"},L={class:"d-flex"},O={class:"card-title"},G=["onClick"],J={class:"card-text"},Q={__name:"Products",setup(M){S();const o="https://ttshop-server.onrender.com",u=C("$swal"),{user:c,token:r}=JSON.parse(localStorage.getItem("ttshop")),p=b([]),v=b([]),k=()=>{h.get(`${o}/products`).then(({data:t})=>{p.value=t}).catch(t=>{var s;console.dir(t),u((s=t==null?void 0:t.response)==null?void 0:s.data)})},y=t=>{h({method:"GET",url:`${o}/600/users/${c.id}/likes?productId=${t}`,headers:{Authorization:`Bearer ${r}`}}).then(({data:s})=>{const n=s.length>0?s[0].id:null;w(n,c.id,t)}).catch(s=>{var n;console.dir(s),u((n=s==null?void 0:s.response)==null?void 0:n.data)})},w=(t,s,n)=>{const e=t===null?"POST":"DELETE",$=t===null?`${o}/600/likes/`:`${o}/600/likes/${t}`;h({method:e,url:$,data:t===null?{userId:s,productId:n}:{},headers:{Authorization:`Bearer ${r}`}}).then(i=>{g()}).catch(i=>{var f;console.dir(i),u((f=i==null?void 0:i.response)==null?void 0:f.data)})},g=()=>{h({method:"get",url:`${o}/600/users/${c.id}/likes?_expanded=post`,headers:{Authorization:`Bearer ${r}`}}).then(({data:t})=>{v.value=t.map(s=>({...s,userId:s.userId*1})),k()}).catch(t=>{var s;console.dir(t),u((s=t==null?void 0:t.response)==null?void 0:s.data)})},B=t=>v.value.find(s=>s.productId===t)===void 0;return E(()=>{k(),c&&g()}),(t,s)=>{const n=F("router-link");return l(),d("div",null,[_(" 景點頁面 "),a("div",z,[a("div",A,[p.value.length>0?(l(!0),d(x,{key:0},N(p.value,e=>(l(),d("div",{key:e.id,class:"col-4"},[a("div",j,[a("img",{src:e.imageUrl,class:"card-img-top"},null,8,D),a("div",I,[a("div",L,[a("h5",O,m(e.title),1),P(c)?(l(),d("button",{key:0,onClick:$=>y(e.id),class:"btn btn-outline-primary"},[a("span",null,m(B(e.id)?"加入":"取消"),1),_("最愛 ")],8,G)):T("",!0)]),a("p",J,m(e.content),1),U(n,{to:`/product/${e.id}`,class:"btn btn-primary"},{default:V(()=>[_("看詳細")]),_:2},1032,["to"])])])]))),128)):(l(),d(x,{key:1},[_(" 沒有景點 ")],64))])])])}}};export{Q as default};
