import{a as h}from"./axios-a900fd7e.js";import{h as E,i as F,r as b,o as N,a as P,b as l,c as d,g as _,d as n,F as x,j as S,t as m,k as T,f as U,e as V,w as z}from"./index-1a7dbddd.js";const A={class:"container"},j={class:"row"},D={class:"card"},L=["src"],G={class:"card-body"},I={class:"d-flex"},M={class:"card-title"},O=["onClick"],q={class:"card-text"},R={__name:"Products",setup(H){const y=E(),o="https://ttshop-server.onrender.com",u=F("$swal"),{user:c,token:r}=y,p=b([]),v=b([]),k=()=>{h.get(`${o}/products`).then(({data:t})=>{p.value=t}).catch(t=>{var s;console.dir(t),u((s=t==null?void 0:t.response)==null?void 0:s.data)})},w=t=>{h({method:"GET",url:`${o}/600/users/${c.id}/likes?productId=${t}`,headers:{Authorization:`Bearer ${r}`}}).then(({data:s})=>{const a=s.length>0?s[0].id:null;B(a,c.id,t)}).catch(s=>{var a;console.dir(s),u((a=s==null?void 0:s.response)==null?void 0:a.data)})},B=(t,s,a)=>{const e=t===null?"POST":"DELETE",g=t===null?`${o}/600/likes/`:`${o}/600/likes/${t}`;h({method:e,url:g,data:t===null?{userId:s,productId:a}:{},headers:{Authorization:`Bearer ${r}`}}).then(i=>{$()}).catch(i=>{var f;console.dir(i),u((f=i==null?void 0:i.response)==null?void 0:f.data)})},$=()=>{h({method:"get",url:`${o}/600/users/${c.id}/likes?_expanded=post`,headers:{Authorization:`Bearer ${r}`}}).then(({data:t})=>{v.value=t.map(s=>({...s,userId:s.userId*1})),k()}).catch(t=>{var s;console.dir(t),u((s=t==null?void 0:t.response)==null?void 0:s.data)})},C=t=>v.value.find(s=>s.productId===t)===void 0;return N(()=>{k(),c&&$()}),(t,s)=>{const a=P("router-link");return l(),d("div",null,[_(" 景點頁面 "),n("div",A,[n("div",j,[p.value.length>0?(l(!0),d(x,{key:0},S(p.value,e=>(l(),d("div",{key:e.id,class:"col-4"},[n("div",D,[n("img",{src:e.imageUrl,class:"card-img-top"},null,8,L),n("div",G,[n("div",I,[n("h5",M,m(e.title),1),T(c)?(l(),d("button",{key:0,onClick:g=>w(e.id),class:"btn btn-outline-primary"},[n("span",null,m(C(e.id)?"加入":"取消"),1),_("最愛 ")],8,O)):U("",!0)]),n("p",q,m(e.content),1),V(a,{to:`/product/${e.id}`,class:"btn btn-primary"},{default:z(()=>[_("看詳細")]),_:2},1032,["to"])])])]))),128)):(l(),d(x,{key:1},[_(" 沒有景點 ")],64))])])])}}};export{R as default};
